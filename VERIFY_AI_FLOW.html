<!DOCTYPE html>
<html>
<head>
    <title>Verify AI Flow</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { background: #4CAF50; color: white; padding: 15px 30px; border: none; cursor: pointer; font-size: 16px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 4px solid #2196F3; }
    </style>
</head>
<body>
    <h1>Verify AI Content Generation Flow</h1>
    <button onclick="testFlow()">Test Complete Flow</button>
    <div id="logs"></div>

    <script>
        async function testFlow() {
            const logs = document.getElementById('logs');
            logs.innerHTML = '';
            
            function log(msg) {
                logs.innerHTML += `<div class="log">${msg}</div>`;
            }
            
            log('Step 1: Teacher fills form with basic info...');
            
            const teacherInput = {
                user_phone: "+250789751597",
                sector: "ICT",
                trade: "Programming",
                module_code_title: "PRG101 - C Programming",
                topic_of_session: "WHILE loops in C",
                learning_outcomes: "Understand WHILE loop syntax and usage",
                indicative_contents: "Loop syntax, conditions, examples",
                duration: "45 minutes",
                facilitation_techniques: "Trainer Guided",
                trainer_name: "John Doe",
                date: "2024-01-15",
                term: "Term 1",
                class_name: "Class A",
                number_of_trainees: "25",
                range: "All learners in Level 4 Programming class",
                appendix: "Sample C code examples, Practice exercises, Assessment rubrics"
            };}
            
            log('Step 2: Sending to backend for AI generation...');
            
            try {
                const response = await fetch('https://rtb-document-planner.onrender.com/session-plans', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(teacherInput)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`✅ Step 3: AI generated content and saved to database (ID: ${result.id})`);
                    log('Step 4: Downloading document with official RTB template...');
                    
                    const downloadUrl = `https://rtb-document-planner.onrender.com/session-plans/${result.id}/download?phone=%2B250789751597`;
                    const dlResponse = await fetch(downloadUrl);
                    
                    if (dlResponse.ok) {
                        const blob = await dlResponse.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `Session_Plan_${result.id}.docx`;
                        a.click();
                        
                        log(`✅ Step 5: Document generated with official RTB template (${blob.size} bytes)`);
                        log('✅ COMPLETE! Check downloaded document for:');
                        log('   - AI-generated objectives (3-5 items)');
                        log('   - AI-generated learning activities (Intro/Dev/Conclusion)');
                        log('   - AI-generated assessment details');
                        log('   - AI-generated references (3-5 resources)');
                        log('   - Official RTB template format');
                    } else {
                        log(`❌ Download failed: ${await dlResponse.text()}`);
                    }
                } else {
                    log(`❌ Creation failed: ${JSON.stringify(result)}`);
                }
            } catch (error) {
                log(`❌ Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>
